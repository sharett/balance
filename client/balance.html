<head>
  <title>Balance</title>
  <style>
  body {
	padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
  }
  </style>
</head>

<body>
{{> dialogs}}

{{> navbar}}

<div class="container-fluid">
  <div class="row-fluid">
		<div class="span3">
			<div class="well sidebar-nav">
				{{> groups}}
			</div><!--/.well -->
		</div><!--/span-->
		<div class="span9">
			<div class="row-fluid">
			{{> main}}
			</div>
		</div>
  </div>
</div> <!-- /container -->

</body>

<template name="dialogs">
  {{#if showEditGroupDialog}}
  {{> editGroup}}
  {{/if}}
  {{#if showProfileDialog}}
  {{> editProfile}}
  {{/if}}
  {{#if showTransactionDialog}}
  {{> editTransaction}}
  {{/if}}
</template>

<template name="navbar">
<div class="navbar navbar-inverse navbar-fixed-top">
  <div class="navbar-inner">
	<div class="container-fluid">
	  <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
		<span class="icon-bar"></span>
		<span class="icon-bar"></span>
		<span class="icon-bar"></span>
	  </button>
	  <a class="brand go-home" href="#">Balance</a>
	  <div class="nav-collapse collapse">
		<ul class="nav">
		  <li><a href="#" class="go-home">Home</a></li>
		  {{#if currentUser}}
		  <li><a href="#" class="editprofile">Profile</a></li> 
		  {{/if}}
		</ul>
	  </div><!--/.nav-collapse -->
	  <div style="float: right">
  	  {{loginButtons align="right"}}
	  </div>
	</div>
  </div>
</div>
</template>

<template name="main">
{{#if currentUser}}
 {{#if selected_group}}
   {{#if is_user_member_of_selected_group}}
		 {{#if selected_member}}
			 {{> member}}
		 {{else}}
			 {{> transactions}}
		 {{/if}}
	 {{else}}
	   {{> home}}
	 {{/if}}
 {{else}}
   {{> home}}
 {{/if}}
{{else}}
 {{> home}}
{{/if}}
</template>

<template name="home">
	<div class="hero-unit">
		<h1>Balance</h1>
		<p>Balance is a tool to keep track of shared finances for groups.</p>
		<p><a href="#" class="btn btn-primary btn-medium">Learn more &raquo;</a></p>
	</div>
	<div class="row-fluid">
		<div class="span4">
			<h2>Mutual credit</h2>
			<p>Balance is a mutual credit system.  Everyone's balance starts at zero.  In the
			simplest transaction, one person's balance goes down and the other's goes up by an
			equal amount.</p>
			<p><a class="btn" href="#">View details &raquo;</a></p>
		</div><!--/span-->
		<div class="span4">
			<h2>Transactions</h2>
			<p>Keep track of complicated transactions, such as bills that one person pays, but
			everyone shares in.  Balance keeps a running total of how much each person owes or
			is owed.</p>
			<p><a class="btn" href="#">View details &raquo;</a></p>
		</div><!--/span-->
		<div class="span4">
			<h2>Fewest payments</h2>
			<p>When the time comes to settle up, Balance will calculate the minimum number of 
			payments required to pay everyone and bring everyone's balance back to zero.</p>
			<p><a class="btn" href="#">View details &raquo;</a></p>
		</div><!--/span-->
	</div><!--/row-->
	<div class="row-fluid">
		<div class="span4">
			<h2>Credit limits</h2>
			<p>You decide how much credit you are willing to extend to each person.  Balance makes
			sure no transactions will exceed those limits.</p>
			<p><a class="btn" href="#">View details &raquo;</a></p>
		</div><!--/span-->
		<div class="span4">
			<h2>Permissions</h2>
			<p>You set what permissions are needed to create, modify and remove transactions.  An informal
			group of friends may allow any transactions, while others may require approval of each
			transaction.</p>
			<p><a class="btn" href="#">View details &raquo;</a></p>
		</div><!--/span-->
		<div class="span4">
			<h2>Currencies</h2>
			<p>Balance supports the currency of your choice, including time-based currencies for keeping
			track of hours worked.</p>
			<p><a class="btn" href="#">View details &raquo;</a></p>
		</div><!--/span-->
	</div><!--/row-->
</template>

<template name="member">
 <button class="btn btn-small member-return">&lt;&lt; back to transactions</button>
 <h3>{{member.profile.name}}</h3>
 <p>Balance in this group: ${{balance}}</p>
 {{#if me}}
 <p>Net balance in all groups: ${{total_balance}}</p>
 {{else}}
   <div class="alert alert-success" {{#unless note}}style="display: none"{{/unless}}>{{note}}</div>
   <form>
	<fieldset>
	 <legend>Credit limits</legend>
     <label>{{member.profile.name}} will lend you up to: <strong>${{credit_to_me}}</strong></label>
     <label>You will lend {{member.profile.name}} up to:</label>
     <div class="input-prepend">
      <span class="add-on">$</span>
      <input id="member_credit" type="text" class="credit span5" value="{{credit}}" />
     </div>
     <br />
     <button type="submit" class="btn extend">Update</button>
    </fieldset>
   </form>
 {{/if}}
</template>

<template name="transactions">
 <h3>
   Transactions
   <button style="float: right;" class="btn transaction-add">Add</button>
 </h3>
 <table class="table table-striped table-hover">
  <thead>
   <tr>
    <th>date</th>
	<th>description</th>
	<th>total</th>
	<th>debit</th>
	<th>credit</th>
   </tr>
  </thead>
  <tbody> 
	 {{#each transactions}}
	 {{> transaction}}
	 {{/each}}
   {{#unless transaction_count}}
     <tr>
       <td colspan="5">No transactions.</td>
     </tr>
   {{/unless}}
  </tbody>
 </table>
</template>

<template name="transaction">
  <tr{{#if selected}} class="info"{{/if}}>
    <td>{{date}}</td>
    <td>{{description}}</td>
    <td>{{total}}</td>
    <td>{{debits}}</td>
    <td>{{credits}}</td>
    <td>
			<div class="btn-group">
       <button class="btn btn-small transaction-edit" title="Edit this transaction">
				 <i class="icon-pencil"></i>
			 </button>
       <button class="btn btn-small transaction-remove" title="Remove this transaction">
				 <i class="icon-remove"></i>
			 </button>
     </div>
    </td>
  </tr>
</template>

<template name="groups">
{{#if currentUser}}
  {{#unless selected_group}}
  <h4>Select or create a group.</h4>
  {{/unless}}
	<h5>
	Group: 
	<div class="btn-group">
		<a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
		 {{#if selected_group}}{{group.name}}{{else}}(please choose){{/if}}
		 <span class="caret"></span>
		</a>
		<ul class="dropdown-menu">
		 <li class="nav-header">My Groups</li>
		 {{#each groups}}
			 {{> group}}
		 {{/each}}
		 <li class="divider"></li>
		 <li><a href="#" class="creategroup">New group...</a></li>
		 <li class="divider"></li>
		 <li class="nav-header">Other Groups</li>
		 {{#each other_groups}}
			 {{> group}}
		 {{/each}}
		</ul>
	</div>
	</h5>

	<ul class="nav nav-list">
		{{#if selected_group}}
			{{#with group}}
				{{> group_detail}}
			{{/with}}
		{{/if}}
	</ul>
{{else}}
<h4>Create an account or log in to get started.</h4>
{{/if}}
</template>

<template name="group_detail">
  <p>{{description}}</p>
  <li class="nav-header">Members</li>
  {{#if is_member}}
    {{#each member_list}}
      {{> member_detail}}
    {{/each}}
  {{else}}
    <p>Join this group to see its members.</p>
  {{/if}}
  <li class="divider"></li>
  {{#if is_coordinator}}
  With group:
  <div class="btn-group">
   <input type="button" class="btn btn-small editgroup" value="Edit" />
   <input type="button" class="btn btn-small removegroup" value="Remove" />
  </div>
  {{else}}
    {{#if is_member}}
    <input type="button" class="btn btn-small leavegroup" value="Leave this group" />
    {{/if}}
  {{/if}}
  {{#unless is_member}}
  <input type="button" class="btn btn-small joingroup" value="Join this group" />
  {{/unless}}
</template>

<template name="member_detail">
  <li{{#if selected}} class="active"{{/if}}>
    <a href="#" class="{{selected}}">
	  {{displayName}} (${{balance}}) 
      {{#if is_coordinator}}<i class="icon-wrench" title="Group coordinator"></i>{{/if}}
      {{#if me}}<span class="label label-info">You</span>{{/if}}
    </a>
  </li>
</template>

<template name="group">
  <li{{#if selected}} class="active"{{/if}}>
    <a href="#" class="group {{selected}}">{{name}}</a>
  </li>
</template>

<template name="editGroup">
  <div class="mask"> </div>
  <div class="modal">
    <div class="modal-header">
      <button type="button" class="close cancel">&times;</button>
      <h3>{{#if create}}New{{else}}Edit{{/if}} group</h3>
    </div>

    <div class="modal-body">
      {{#if error}}
        <div class="alert alert-error">{{error}}</div>
      {{/if}}

      <label>Name</label>
      <input type="text" class="group_name span5" value="{{group_name}}">

      <label>Description</label>
      <textarea class="description span5">{{description}}</textarea>
    </div>

    <div class="modal-footer">
      <a href="#" class="btn cancel">Cancel</a>
      <a href="#" class="btn btn-primary save">{{#if create}}Create{{else}}Update{{/if}}</a>
    </div>
  </div>
</template>

<template name="editProfile">
  <div class="mask"> </div>
  <div class="modal">
    <div class="modal-header">
      <button type="button" class="close cancel">&times;</button>
      <h3>My profile</h3>
    </div>

    <div class="modal-body">
      {{#if error}}
        <div class="alert alert-error">{{error}}</div>
      {{/if}}

      <label>Full name</label>
      <input type="text" class="full_name span5" value="{{full_name}}">
      <label>Nickname</label>
      <input type="text" class="nickname span5" value="{{nickname}}">
    </div>

    <div class="modal-footer">
      <a href="#" class="btn cancel">Cancel</a>
      <a href="#" class="btn btn-primary save">Update</a>
    </div>
  </div>
</template>

<template name="editTransaction">
  <div class="mask"> </div>
  <div class="modal">
    <div class="modal-header">
      <button type="button" class="close cancel">&times;</button>
      <h3>{{#if create}}New{{else}}Edit{{/if}} transaction</h3>
    </div>

    <div class="modal-body">
      {{#if error}}
        <div class="alert alert-error">{{error}}</div>
      {{/if}}

      <label>Date</label>
      <input type="text" id="transaction-date" class="transaction-date span5" 
             value="{{transaction_date}}">

      <label>Description</label>
      <input type="text" id="transaction-description" class="transaction-description span5" 
             value="{{transaction_description}}">

      <table class="table table-condensed">
			<thead>
			 <tr>
				<th>name</th>
				<th>debit</th>
				<th>credit</th>
			 </tr>
			</thead>
			<tbody>
      {{#each group_members}}
        {{> editTransactionMember}}
      {{/each}}
       <tr class="{{total_ok}}">
        <td colspan="3" style="text-align: center;">
        Total: {{total}}
        </td>
       </tr>
      </tbody>
      </table>
    </div>

    <div class="modal-footer">
      <a href="#" class="btn cancel">Cancel</a>
      <a href="#" class="btn btn-primary save">{{#if create}}Create{{else}}Update{{/if}}</a>
    </div>
  </div>
</template>

<template name="editTransactionMember">
   <tr>
    <td>{{displayName}}:</td>
    <td>
		 <div class="input-prepend">
			<span class="add-on">$</span>
			<input id="d_{{_id}}" type="text" style="color: red;" 
			       class="transaction-amount transaction-debit span1" value="{{debit}}" />
		 </div>
    </td>
    <td>
		 <div class="input-prepend">
			<span class="add-on">$</span>
			<input id="c_{{_id}}" type="text" 
			       class="transaction-amount transaction-credit span1" value="{{credit}}" />
		 </div>
    </td>
   </tr>
</template>
